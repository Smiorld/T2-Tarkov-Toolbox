# 位置追踪功能 - 快速使用指南

## 功能概述

位置追踪功能可以自动检测你的游戏截图，并在地图上实时显示你的位置和朝向。

## 快速开始

### 第一步：校准地图（仅需一次）

1. **选择地图**
   - 在左侧"选择地图"下拉框中选择你要玩的地图（如Customs）

2. **导入地图图片**
   - 点击"导入地图图片"按钮
   - 选择地图的图片文件
   - 配置层级信息（地面层通常用ID=0）

3. **开启校准模式**
   - 勾选"校准模式"开关
   - 状态栏显示：`校准模式: 在游戏中截图，然后在地图上点击对应位置`

4. **添加校准点（至少3个）**

   **操作流程**：
   ```
   游戏中 → 找到标志性位置 → 截图 → 在地图图片上点击对应位置 → 重复
   ```

   **示例**：
   - 站在海关大桥中心 → 截图 → 在地图上点击大桥中心
   - 站在加油站门口 → 截图 → 在地图上点击加油站门口
   - 站在宿舍楼角落 → 截图 → 在地图上点击宿舍角落

5. **验证校准**
   - 添加3个点后会弹出提示："已添加3个校准点！"
   - 查看平均误差（应该 < 10像素）
   - 关闭校准模式开关

### 第二步：启用位置追踪

1. **开启位置追踪**
   - 勾选"启用位置追踪"开关
   - 状态栏显示：`位置追踪已启用 - 游戏中截图将自动显示位置`

2. **进入游戏**
   - 启动塔科夫
   - 进入战局（选择与校准相同的地图）

3. **截图查看位置**
   - 按截图键（默认PrintScreen）
   - 软件自动检测截图
   - 地图上显示你的位置（绿色圆圈）和朝向（绿色箭头）

## 界面说明

### 左侧控制面板

```
┌────────────────────────┐
│ 选择地图: [Customs ▼] │  ← 选择要追踪的地图
│ 选择层级: [Layer 0  ▼]│  ← 选择楼层（多层建筑）
├────────────────────────┤
│ [导入地图图片]         │  ← 第一次使用时导入
│ [配置层级高度]         │  ← 配置楼层高度范围
├────────────────────────┤
│ 校准模式                │
│ [√] 校准模式           │  ← 校准时开启
│ 校准点: 3/3 ✓          │  ← 显示校准状态
│ [清除校准点]           │  ← 重新校准时使用
├────────────────────────┤
│ 视图控制                │
│ 缩放: [滑块 0.1-3.0]   │  ← 调整地图缩放
│ [重置视图]             │  ← 恢复默认视图
├────────────────────────┤
│ 位置追踪                │
│ [√] 启用位置追踪       │  ← 开启自动追踪
├────────────────────────┤
│ [配置路径]             │  ← 配置截图/日志路径
└────────────────────────┘
```

### 右侧地图显示

- **地图图片** - 显示你导入的地图
- **红色标记** - 校准点（标注为P1, P2, P3...）
- **绿色圆圈** - 你的当前位置
- **绿色箭头** - 你的朝向
- **状态栏** - 显示坐标、高度、朝向信息

## 使用场景

### 场景1：日常游戏导航

```
1. 打开软件 → 选择地图 → 开启位置追踪
2. 进入游戏战局
3. 游戏中按截图键 → 软件显示位置
4. 根据地图规划路线
5. 移动后再次截图 → 更新位置
```

### 场景2：学习地图

```
1. 进入离线模式（Scav或PMC）
2. 开启位置追踪
3. 在地图中探索
4. 定期截图查看自己在哪里
5. 记住关键位置和路线
```

### 场景3：任务导航

```
1. 查看任务要求（如"在加油站放置物品"）
2. 在地图上找到目标位置
3. 开启位置追踪
4. 进入游戏截图查看当前位置
5. 根据地图导航到目标点
```

## 高级功能

### 多楼层建筑追踪

**适用地图**：Interchange（商场）、Reserve（储备站）

**配置步骤**：

1. **为每层导入地图**
   ```
   Layer 0 (地面层): height_min=-5, height_max=5
   Layer 1 (一楼):   height_min=5,  height_max=10
   Layer 2 (二楼):   height_min=10, height_max=15
   ```

2. **为每层单独校准**
   - 切换到Layer 0 → 在游戏中去地面层 → 校准
   - 切换到Layer 1 → 在游戏中上一楼 → 校准
   - 切换到Layer 2 → 在游戏中上二楼 → 校准

3. **自动楼层匹配**
   - 开启位置追踪
   - 软件根据截图的Y坐标自动选择楼层
   - 例如：Y=7.5 → 自动显示在一楼地图

### 精确校准技巧

**选择校准点的原则**：

1. **选择明显的标志性位置**
   - ✅ 建筑物角落
   - ✅ 十字路口中心
   - ✅ 桥梁、雕像、标志牌
   - ❌ 空旷草地（不好定位）
   - ❌ 树林中间（难以分辨）

2. **分散分布**
   - 在地图的四个角落各选一个点
   - 避免所有点都集中在一个区域

3. **精确点击**
   - 放大地图后再点击
   - 尽量点在特征的中心位置

4. **验证精度**
   - 查看平均误差
   - 如果 > 10像素，清除重新校准

## 常见问题

### Q: 位置追踪开关无法开启？

**原因**：当前地图层级尚未完成校准

**解决**：
1. 确认至少添加了3个校准点
2. 查看校准信息显示"3/3 ✓"
3. 如果未校准，开启校准模式添加校准点

### Q: 截图后位置不显示？

**可能原因和解决方法**：

1. **位置追踪未开启**
   - 检查"启用位置追踪"开关是否勾选

2. **截图路径不正确**
   - 点击"配置路径"
   - 确认截图路径正确（默认：`文档\Escape From Tarkov\Screenshots`）

3. **地图选择错误**
   - 确认软件中选择的地图与游戏中相同
   - 例如：游戏在Customs，软件也要选Customs

4. **截图文件名格式不匹配**
   - 查看控制台输出是否有解析错误
   - 确认游戏截图功能正常工作

### Q: 显示的位置不准确？

**可能原因**：

1. **校准点不够**
   - 建议添加4-5个校准点
   - 校准点应分散分布

2. **校准点标注不准**
   - 清除校准点
   - 重新仔细标注

3. **地图图片方向错误**
   - 地图图片应该正北朝上
   - 如果方向不对，需要旋转图片后重新导入

### Q: 多楼层建筑楼层匹配错误？

**可能原因**：楼层高度范围配置重叠或错误

**解决方法**：
1. 点击"配置层级高度"
2. 检查每层的height_min和height_max
3. 确保各层高度范围不重叠：
   ```
   正确示例：
   Layer 0: -5.0 到 5.0   ✓
   Layer 1: 5.0 到 10.0   ✓

   错误示例：
   Layer 0: 0 到 10.0     ✗
   Layer 1: 5.0 到 15.0   ✗  (5-10重叠)
   ```

## 性能优化

### 内存占用

- 地图图片建议尺寸：1920x1080 到 2560x1440
- 超大图片（>4096px）会自动压缩
- 缩放操作使用缓存，避免重复计算

### 响应速度

- 拖拽地图：60fps流畅
- 滚轮缩放：50-100ms响应
- 截图检测：1-2秒延迟（文件系统监控）

## 数据管理

### 配置文件位置

```
项目根目录/map_config.json
```

### 备份校准数据

**推荐定期备份 `map_config.json` 文件**

备份后，即使重装软件也能快速恢复：
```bash
# 备份
copy map_config.json map_config.backup.json

# 恢复
copy map_config.backup.json map_config.json
```

### 分享校准数据

如果你的朋友也使用这个软件，可以分享你的校准数据：

1. 确保双方使用相同的地图图片
2. 复制你的 `map_config.json` 给他
3. 他替换自己的配置文件即可使用

## 快捷键参考

| 操作 | 快捷键/鼠标 |
|------|------------|
| 截图（游戏内） | PrintScreen |
| 平移地图 | 鼠标左键拖拽 |
| 缩放地图 | 鼠标滚轮 |
| 添加校准点 | 鼠标左键点击（校准模式） |

## 使用建议

1. **先在离线模式测试**
   - 熟悉功能后再在线上使用

2. **为常玩的地图都做校准**
   - 每个地图只需校准一次
   - 校准数据永久保存

3. **定期截图更新位置**
   - 移动一段距离后截图
   - 保持位置信息最新

4. **结合任务地图使用**
   - 在任务地图上标注目标
   - 使用位置追踪导航过去

---

**祝游戏愉快！撤离成功！** 🎮🗺️
